<mxfile host="app.diagrams.net" modified="2025-01-20" agent="Claude" version="21.0.0">
  <diagram name="Flowchart Update Status" id="flowchart-update-status">
    <mxGraphModel dx="1400" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Flowchart: Update Payment Status (Outbound Process)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;fontColor=#1e3a5f;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Start -->
        <mxCell id="start" value="Start" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="620" y="80" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Process: Schedule Timer -->
        <mxCell id="p1" value="Scheduled Timer&#xa;Triggers&#xa;(Every 5 minutes)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="590" y="160" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Process: Query Pending Invoices -->
        <mxCell id="p2" value="Query Pending Invoices&#xa;from @SLD_PDMS_LOG&#xa;WHERE Status = 'SUCCESS'&#xa;AND PaymentStatus IS NULL" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="570" y="250" width="200" height="80" as="geometry" />
        </mxCell>

        <!-- Decision: Has Pending? -->
        <mxCell id="d1" value="Has Pending&#xa;Invoices?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="360" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Loop Start -->
        <mxCell id="loop" value="For Each Invoice" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="595" y="480" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- Process: Get DocEntry -->
        <mxCell id="p3" value="Get DocEntry&#xa;from Log Record" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="550" width="150" height="50" as="geometry" />
        </mxCell>

        <!-- Process: Query SAP Payment -->
        <mxCell id="p4" value="Query SAP B1&#xa;VendorPayments&#xa;by Invoice DocEntry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="630" width="150" height="60" as="geometry" />
        </mxCell>

        <!-- Decision: Payment Found? -->
        <mxCell id="d2" value="Payment&#xa;Found?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="720" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Process: Get Payment Details -->
        <mxCell id="p5" value="Extract Payment Details&#xa;- DocNum&#xa;- DocDate&#xa;- PaymentAmount" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="595" y="840" width="150" height="70" as="geometry" />
        </mxCell>

        <!-- Process: Call PDMS API -->
        <mxCell id="p6" value="Call PDMS API&#xa;PATCH /api/invoices/{id}&#xa;Update Payment Status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="595" y="940" width="150" height="60" as="geometry" />
        </mxCell>

        <!-- Decision: API Success? -->
        <mxCell id="d3" value="API&#xa;Success?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="1030" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Process: Update Log Success -->
        <mxCell id="p7" value="Update @SLD_PDMS_LOG&#xa;SET PaymentStatus = 'PAID'&#xa;PaymentDocNum = {docnum}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="400" y="1040" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Process: Update Log Error -->
        <mxCell id="p8" value="Update @SLD_PDMS_LOG&#xa;SET PaymentStatus = 'ERROR'&#xa;ErrorMessage = {error}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="780" y="1040" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Loop End -->
        <mxCell id="loopend" value="Next Invoice" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="595" y="1140" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- End -->
        <mxCell id="end" value="End" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="620" y="1210" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Skip Label -->
        <mxCell id="skip" value="Skip&#xa;(No Payment Yet)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=10;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="780" y="740" width="100" height="40" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <!-- Start to P1 -->
        <mxCell id="a1" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="start" target="p1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P1 to P2 -->
        <mxCell id="a2" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p1" target="p2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P2 to D1 -->
        <mxCell id="a3" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p2" target="d1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D1 Yes to Loop -->
        <mxCell id="a4" value="Yes" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2e7d32;" edge="1" parent="1" source="d1" target="loop">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D1 No to End -->
        <mxCell id="a5" value="No" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#c62828;" edge="1" parent="1" source="d1" target="end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="400" />
              <mxPoint x="400" y="1235" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Loop to P3 -->
        <mxCell id="a6" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="loop" target="p3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P3 to P4 -->
        <mxCell id="a7" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p3" target="p4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P4 to D2 -->
        <mxCell id="a8" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p4" target="d2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D2 Yes to P5 -->
        <mxCell id="a9" value="Yes" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2e7d32;" edge="1" parent="1" source="d2" target="p5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D2 No to LoopEnd -->
        <mxCell id="a10" value="No" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#c62828;" edge="1" parent="1" source="d2" target="loopend">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="760" />
              <mxPoint x="860" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- P5 to P6 -->
        <mxCell id="a11" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p5" target="p6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P6 to D3 -->
        <mxCell id="a12" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p6" target="d3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D3 Yes to P7 -->
        <mxCell id="a13" value="Yes" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2e7d32;" edge="1" parent="1" source="d3" target="p7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- D3 No to P8 -->
        <mxCell id="a14" value="No" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#c62828;" edge="1" parent="1" source="d3" target="p8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- P7 to LoopEnd -->
        <mxCell id="a15" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p7" target="loopend">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- P8 to LoopEnd -->
        <mxCell id="a16" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="p8" target="loopend">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- LoopEnd to End -->
        <mxCell id="a17" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1" source="loopend" target="end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Loop back arrow -->
        <mxCell id="a18" value="More" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#9673a6;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="595" y="1160" as="sourcePoint" />
            <mxPoint x="520" y="500" as="targetPoint" />
            <Array as="points">
              <mxPoint x="520" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="180" height="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="50" y="90" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg1" value="" style="ellipse;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg1t" value="Start/End" style="text;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="118" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg2" value="" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="60" y="150" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg2t" value="Process" style="text;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="148" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg3" value="" style="rhombus;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="60" y="180" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg3t" value="Decision" style="text;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="178" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg4" value="" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="60" y="210" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg4t" value="Database Query" style="text;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="208" width="100" height="20" as="geometry" />
        </mxCell>

        <mxCell id="leg5" value="" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="60" y="240" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg5t" value="API Call / Success" style="text;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="238" width="100" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
